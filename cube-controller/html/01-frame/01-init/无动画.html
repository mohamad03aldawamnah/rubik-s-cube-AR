<!DOCTYPE html>
<html>

<head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script>
        AFRAME.registerComponent('rotation-controller', {
            init: function () {
                // 获取所有魔方方块
                this.cubes = this.el.querySelectorAll('.cube');
                this.rotationAmount = 90; // 每次旋转的角度（90度）
                this.lastRotationTime = 0; // 上次旋转的时间
                this.cooldownTime = 300; // 冷却时间（防止频繁旋转）
            },

            tick: function () {
                const currentTime = Date.now();

                // 检查冷却时间
                if (currentTime - this.lastRotationTime < this.cooldownTime) {
                    return; // 如果冷却时间未过，跳过此次操作
                }

                // 检测按键操作
                if (this.isKeyPressed('q')) {
                    this.rotateLayer('y', 1); // 旋转 y == 1 层
                    this.lastRotationTime = currentTime; // 更新上次旋转时间
                }
                if (this.isKeyPressed('e')) {
                    this.rotateLayer('y', -1); // 旋转 y == -1 层
                    this.lastRotationTime = currentTime; // 更新上次旋转时间
                }
                if (this.isKeyPressed('z')) {
                    this.rotateLayer('z', 1); // 旋转 z == 1 层
                    this.lastRotationTime = currentTime; // 更新上次旋转时间
                }
                if (this.isKeyPressed('x')) {
                    this.rotateLayer('z', -1); // 旋转 z == -1 层
                    this.lastRotationTime = currentTime; // 更新上次旋转时间
                }
                if (this.isKeyPressed('c')) {
                    this.rotateLayer('x', 1); // 旋转 x == 1 层
                    this.lastRotationTime = currentTime; // 更新上次旋转时间
                }
                if (this.isKeyPressed('v')) {
                    this.rotateLayer('x', -1); // 旋转 x == -1 层
                    this.lastRotationTime = currentTime; // 更新上次旋转时间
                }
            },

            // 检测某个按键是否按下
            isKeyPressed: function (key) {
                return window.keyState[key] === true;
            },

            // 根据轴和方向来旋转方块
            rotateLayer: function (axis, direction) {
                this.cubes.forEach(cube => {
                    const pos = cube.getAttribute('position');

                    // 检查每个方块是否属于目标层（轴方向上的层）
                    if (axis === 'y' && pos.y === direction) {
                        let rotation = cube.getAttribute('rotation');
                        rotation[axis] = rotation[axis] + (direction * this.rotationAmount);
                        cube.setAttribute('rotation', rotation);
                    }
                    if (axis === 'z' && pos.z === direction) {
                        let rotation = cube.getAttribute('rotation');
                        rotation[axis] = rotation[axis] + (direction * this.rotationAmount);
                        cube.setAttribute('rotation', rotation);
                    }
                    if (axis === 'x' && pos.x === direction) {
                        let rotation = cube.getAttribute('rotation');
                        rotation[axis] = rotation[axis] + (direction * this.rotationAmount);
                        cube.setAttribute('rotation', rotation);
                    }
                });
            }
        });

        // 监听按键事件
        window.keyState = {};

        window.addEventListener('keydown', function (event) {
            window.keyState[event.key] = true;
        });

        window.addEventListener('keyup', function (event) {
            window.keyState[event.key] = false;
        });
    </script>

    <a-assets>
        <img id="my-image" src="../../image.png">
        <a-asset-item id="cube" src="../../../RBsCubeWorldOrigin.glb"></a-asset-item>
    </a-assets>

</head>

<body style="margin: 0px; overflow: hidden;">
<a-scene>
    <a-sky color="black"></a-sky>
    <a-camera position="0 1 13"></a-camera>
    <a-curvedimage src="#my-image" height="200" radius="140" theta-length="160" rotation="0 120 0" scale="1 1 1" position="0 0 0"></a-curvedimage>
    <a-curvedimage color="#570000" metalness="10" rotation="0 0 0" position="0 0 0" height="0.2" radius="5" theta-length="360"></a-curvedimage>
    <a-text value="Dev Mode" color="white" width="10" font="https://cdn.aframe.io/fonts/DejaVu-sdf.fnt" position="-1 11 0"></a-text>
    <a-torus-knot color="#B84A39" arc="180" p="2" q="9" radius="1" radius-tubular="0.05" position="-10 25 -60"></a-torus-knot>

    <a-entity class="RBsCube" rotation-controller>
        <!-- 下面是魔方的方块，每个方块的位置和旋转都已经设置好了 -->
        <!-- 现在补充y==0层的方块 -->
        <a-gltf-model src="#cube" class="cube" position="0 0 0"></a-gltf-model> <!-- y == 0 层 -->
        <a-gltf-model src="#cube" class="cube" position="0 0 1"></a-gltf-model> <!-- y == 0 层 -->
        <a-gltf-model src="#cube" class="cube" position="1 0 0"></a-gltf-model> <!-- y == 0 层 -->
        <a-gltf-model src="#cube" class="cube" position="1 0 1"></a-gltf-model> <!-- y == 0 层 -->
        <a-gltf-model src="#cube" class="cube" position="0 0 -1"></a-gltf-model> <!-- y == 0 层 -->
        <a-gltf-model src="#cube" class="cube" position="-1 0 0"></a-gltf-model> <!-- y == 0 层 -->
        <a-gltf-model src="#cube" class="cube" position="-1 0 -1"></a-gltf-model> <!-- y == 0 层 -->
        <a-gltf-model src="#cube" class="cube" position="1 0 -1"></a-gltf-model> <!-- y == 0 层 -->
        <a-gltf-model src="#cube" class="cube" position="-1 0 1"></a-gltf-model> <!-- y == 0 层 -->
        <a-gltf-model src="#cube" class="cube" position="0 1 0"></a-gltf-model> <!-- y == 1 层 -->
        <a-gltf-model src="#cube" class="cube" position="0 1 1"></a-gltf-model> <!-- y == 1 层 -->
        <a-gltf-model src="#cube" class="cube" position="1 1 0"></a-gltf-model> <!-- y == 1 层 -->
        <a-gltf-model src="#cube" class="cube" position="1 1 1"></a-gltf-model> <!-- y == 1 层 -->
        <a-gltf-model src="#cube" class="cube" position="0 1 -1"></a-gltf-model> <!-- y == 1 层 -->
        <a-gltf-model src="#cube" class="cube" position="-1 1 0"></a-gltf-model> <!-- y == 1 层 -->
        <a-gltf-model src="#cube" class="cube" position="-1 1 -1"></a-gltf-model> <!-- y == 1 层 -->
        <a-gltf-model src="#cube" class="cube" position="1 1 -1"></a-gltf-model> <!-- y == 1 层 -->
        <a-gltf-model src="#cube" class="cube" position="-1 1 1"></a-gltf-model> <!-- y == 1 层 -->
        <a-gltf-model src="#cube" class="cube" position="0 -1 0"></a-gltf-model> <!-- y == -1 层 -->
        <a-gltf-model src="#cube" class="cube" position="0 -1 1"></a-gltf-model> <!-- y == -1 层 -->
        <a-gltf-model src="#cube" class="cube" position="1 -1 0"></a-gltf-model> <!-- y == -1 层 -->
        <a-gltf-model src="#cube" class="cube" position="1 -1 1"></a-gltf-model> <!-- y == -1 层 -->
        <a-gltf-model src="#cube" class="cube" position="0 -1 -1"></a-gltf-model> <!-- y == -1 层 -->
        <a-gltf-model src="#cube" class="cube" position="-1 -1 0"></a-gltf-model> <!-- y == -1 层 -->
        <a-gltf-model src="#cube" class="cube" position="-1 -1 -1"></a-gltf-model> <!-- y == -1 层 -->
        <a-gltf-model src="#cube" class="cube" position="1 -1 -1"></a-gltf-model> <!-- y == -1 层 -->
        <a-gltf-model src="#cube" class="cube" position="-1 -1 1"></a-gltf-model> <!-- y == -1 层 -->
    </a-entity>
</a-scene>
</body>

</html>
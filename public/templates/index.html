<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Rubik's Cube AR</title>
    <link rel="stylesheet" href="style/index.css">
</head>

<script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.6.2/aframe/build/aframe-ar.js"></script>
<script>
    AFRAME.registerComponent('rbscube-controller', {
        init: function () {
            let isAnimating = false; // Initially, no animation is in progress

            window.addEventListener('keydown', (event) => {
                if ((event.key === 'q' || event.key === 'Q') && !isAnimating) {
                    isAnimating = true; // Set to animating when the animation starts

                    // Get the current rotation angles
                    let x = this.el.getAttribute('rotation').x;
                    let y = this.el.getAttribute('rotation').y;
                    let z = this.el.getAttribute('rotation').z;

                    // Set the target rotation angle and step for rotation
                    let targetY = y + 90;
                    let step = 5;
                    let interval = 10; // Update every 10 milliseconds

                    // Use setInterval to implement a smooth animation
                    let rotateInterval = setInterval(() => {
                        if (y < targetY) {
                            y += step;
                            this.el.setAttribute('rotation', { x: x, y: y, z: z });
                        } else {
                            clearInterval(rotateInterval); // Stop the animation when the target angle is reached
                            isAnimating = false; // Reset to allow keypress after animation finishes
                        }
                    }, interval);

                    console.log('Pressed Q  key!');
                }
            });
        },
    });
</script>

<body style="margin: 0px; overflow: hidden;">
<a-scene
        embedded arjs="sourceType: webcam;" renderer="preserveDrawingBuffer: true;">
    <a-marker preset="hiro">
        <a-entity
                rbscube-controller
                position="0 0 0"
                scale="0.5 0.5 0.5"
                gltf-model="url(../models/RBsCubeWorldOrigin.glb)">
        </a-entity>
    </a-marker>
    <a-entity camera></a-entity>

    <a-entity
            rbscube-controller
            position="2.5 -1.5 -8"
            scale="0.3 0.3 0.3"
            gltf-model="url(../models/RBsCubeWorldOrigin.glb)"
    >
    </a-entity>


    <a-text value="Dev Mode" position="-0.5 1 -10"></a-text>
    <a-text value="Press ''Q'' for testing" position="-1 0.5 -10"></a-text>
    <a-text value="(Hint: Hiro marker is available)" position="-1.5 0 -10"></a-text>
</a-scene>
</body>
</html>

